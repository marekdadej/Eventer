@{
    ViewData["Title"] = "Kontakt";
}

<h1>@ViewData["Title"]</h1>
<hr />

@if (TempData["SuccessMessage"] != null)
{
    var alertClass = TempData["SuccessMessage"].ToString().Contains("Błąd") || TempData["SuccessMessage"].ToString().Contains("problem") || TempData["SuccessMessage"].ToString().Contains("za duży") 
                     ? "alert-danger" : "alert-success";

    <div class="alert @alertClass alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="row">
    <div class="col-md-5 mb-4">
        <h4>Dane kontaktowe</h4>
        <address class="mt-3">
            <strong>Agencja Eventer</strong><br />
            Dys, ul. Bernatówka 29A<br />
            21-003 Ciecierzyn<br />
            <br />
            <i class="bi bi-telephone-fill"></i> Krzysztof: <a href="tel:+48509655011" class="text-decoration-none text-dark fw-bold">+48 509 655 011</a><br />
            <i class="bi bi-telephone-fill"></i> Beata: <a href="tel:+48535549511" class="text-decoration-none text-dark fw-bold">+48 535 549 511</a><br />
        </address>

        <address>
            <strong>Napisz do nas:</strong><br />
            <i class="bi bi-envelope-fill"></i> <a href="mailto:biuro@eventer.com.pl" class="text-decoration-none text-dark">biuro@eventer.com.pl</a>
        </address>

        <hr style="border-top: 2px solid #000; opacity: 1; margin: 30px 0;" />

        <h4 class="mb-3">Formularz kontaktowy</h4>
        
        <form id="contactForm" asp-controller="Home" asp-action="SendMessage" method="post" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="firstName" class="form-label">Imię</label>
                    <input type="text" class="form-control" id="firstName" name="firstName" placeholder="Jan" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="lastName" class="form-label">Nazwisko</label>
                    <input type="text" class="form-control" id="lastName" name="lastName" placeholder="Kowalski" required>
                </div>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" placeholder="jan.kowalski@gmail.com" required>
            </div>

            <div class="mb-3">
                <label for="message" class="form-label">Wiadomość</label>
                <textarea class="form-control" id="message" name="message" rows="4" required></textarea>
            </div>

            <div class="mb-3">
                <label for="attachments" class="form-label">Załączniki (max 20MB łącznie)</label>
                <input type="file" class="form-control" id="attachments" name="attachments" multiple accept=".jpg,.jpeg,.png,.pdf,.doc,.docx,.txt">
                
                <div id="fileList" class="mt-2 small text-muted"></div>
                <div id="fileError" class="mt-1 small text-danger fw-bold" style="display:none;"></div>
            </div>

            <button type="submit" id="submitBtn" class="btn btn-primary w-100 fw-bold">Wyślij wiadomość</button>
        </form>
    </div>

    <div class="col-md-7">
        <div class="ratio ratio-4x3 shadow-sm" style="min-height: 400px; border-radius: 8px; overflow: hidden;">
            <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d155.88944863196005!2d22.547116!3d51.306871!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4722576e392a635b%3A0x7e04713a7ab7cfc3!2sEventer%20-%20technika%20estradowa!5e0!3m2!1spl!2sus!4v1768498930883!5m2!1spl!2sus" 
            width="600" 
            height="450" 
            style="border:0;" 
            allowfullscreen="" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>
    </div>
</div>

<script>
    document.getElementById('attachments').addEventListener('change', function(e) {
        const fileList = document.getElementById('fileList');
        const fileError = document.getElementById('fileError');
        const submitBtn = document.getElementById('submitBtn');
        const files = e.target.files;
        
        fileList.innerHTML = '';
        fileError.style.display = 'none';
        fileError.innerText = '';
        submitBtn.disabled = false;

        let totalSize = 0;
        const maxTotalSize = 20 * 1024 * 1024; 

        if (files.length > 0) {
            const ul = document.createElement('ul');
            ul.style.paddingLeft = '20px';
            ul.style.marginBottom = '5px';

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                totalSize += file.size;

                let sizeStr = '';
                if (file.size > 1024 * 1024) {
                    sizeStr = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
                } else {
                    sizeStr = (file.size / 1024).toFixed(2) + ' KB';
                }

                const extension = file.name.split('.').pop().toLowerCase();
                
                const li = document.createElement('li');
                li.innerText = `${file.name} (${sizeStr}) - Format: .${extension}`;
                ul.appendChild(li);
            }
            fileList.appendChild(ul);

            const totalSizeMB = (totalSize / (1024 * 1024)).toFixed(2);
            const summary = document.createElement('div');
            summary.innerHTML = `<strong>Łącznie: ${totalSizeMB} MB</strong>`;
            
            if (totalSize > maxTotalSize) {
                summary.style.color = 'red';
                fileError.innerText = `Pliki są za duże! Limit to 20MB, a Ty masz ${totalSizeMB}MB. Usuń niektóre pliki, aby wysłać formularz.`;
                fileError.style.display = 'block';
                submitBtn.disabled = true; 
            } else {
                summary.style.color = 'green';
            }
            fileList.appendChild(summary);
        }
    });
</script>